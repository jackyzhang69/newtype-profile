#!/bin/sh

# Get staged files count
STAGED_COUNT=$(git diff --cached --name-only | wc -l)

if [ "$STAGED_COUNT" -eq 0 ]; then
  echo "âœ… No changes, skipping checks"
  exit 0
fi

echo "ğŸ” Type checking (typecheck)..."
bun run typecheck || exit 1

echo "ğŸ”¨ Building..."
bun run build || exit 1

# Only run full test suite if committing audit-core or workflow changes
STAGED_FILES=$(git diff --cached --name-only)
if echo "$STAGED_FILES" | grep -qE 'src/audit-core|src/hooks/(audit|workflow)'; then
  echo "ğŸ§ª Running full tests (audit-core changes detected)..."
  bun test || exit 1
else
  echo "â­ï¸  Skipping full tests (non-audit changes)"
fi

echo "âœ… Pre-commit checks passed!"
